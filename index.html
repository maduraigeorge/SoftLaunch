<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Product Launch with Rocket & Butterflies (Improved)</title>
<style>
  body, html {
    margin: 0; padding: 0; height: 100%;
    background: linear-gradient(135deg, #d6c1ff 0%, #a2cfff 100%);
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    color: #3b2e75;
    overflow-x: hidden;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    text-align: center;
  }
  h1#ready-text {
    font-size: clamp(2rem, 5vw, 3rem);
    margin-bottom: 2rem;
    user-select: none;
  }
  #launch-btn {
    font-size: 2.5rem;
    padding: 1em 3em;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    color: white;
    background: linear-gradient(135deg, #7a9cff, #aab8ff);
    box-shadow: 0 0 25px #7a9cff;
    animation: popIn 1s ease forwards;
    user-select: none;
  }
  #launch-btn:hover {
    box-shadow: 0 0 40px #7a9cff;
  }
  @keyframes popIn {
    0% { transform: scale(0.5); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
  }
  #countdown {
    font-size: clamp(4rem, 10vw, 6rem);
    font-weight: 900;
    color: #3b2e75;
    display: none;
    margin: 1rem 0 2rem 0;
    user-select: none;
  }
  #animation-container {
    width: 300px; height: 300px;
    margin: 20px 0;
    display: none;
    pointer-events: none;
  }
  #product-reveal {
    display: none;
    flex-direction: column;
    align-items: center;
    gap: 20px;
    margin-top: 20px;
    opacity: 0;
    transition: opacity 1.5s ease;
  }
  #product-reveal img {
    width: 200px;
    user-select: none;
  }
  #product-reveal h2 {
    color: #3b2e75;
    font-size: clamp(2rem, 5vw, 3rem);
    user-select: none;
  }
</style>
</head>
<body>

  <h1 id="ready-text">Ready for the Big Reveal?</h1>

  <button id="launch-btn" aria-label="Launch Product">Launch</button>

  <div id="countdown" aria-live="assertive" aria-atomic="true"></div>

  <div id="animation-container" aria-live="off" aria-hidden="true"></div>

  <div id="product-reveal" role="region" aria-label="Product Reveal">
    <img src="images/productX-logo.png" alt="Product X Logo and Text" />
    <h2>Product X</h2>
  </div>

  <audio id="countdown-audio" src="audio/countdown_tick.mp3" preload="auto"></audio>
  <audio id="suspense-audio" src="audio/suspense.mp3" preload="auto"></audio>
  <audio id="applause-audio" src="audio/applause.mp3" preload="auto"></audio>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.0/lottie.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    (() => {
      const launchBtn = document.getElementById('launch-btn');
      const readyText = document.getElementById('ready-text');
      const countdownEl = document.getElementById('countdown');
      const animationContainer = document.getElementById('animation-container');
      const productReveal = document.getElementById('product-reveal');

      const countdownAudio = document.getElementById('countdown-audio');
      const suspenseAudio = document.getElementById('suspense-audio');
      const applauseAudio = document.getElementById('applause-audio');

      let animation = null;
      let confettiAnimationId = null;

      async function playAudio(audio) {
        if (!audio) return;
        audio.currentTime = 0;
        try {
          await audio.play();
          return true;
        } catch (e) {
          console.warn("Audio playback error:", e);
          return false;
        }
      }

      function pauseAudio(audio) {
        if (!audio) return;
        try {
          audio.pause();
        } catch {}
      }

      function delay(ms) {
        return new Promise(r => setTimeout(r, ms));
      }

      async function countdown(seconds) {
        countdownEl.style.display = 'block';
        for(let i = seconds; i > 0; i--) {
          countdownEl.textContent = `Countdown: ${i}`;
          playAudio(countdownAudio);
          await delay(1000);
        }
        countdownEl.style.display = 'none';
      }

      function playLottieAnimation(path, loop=false) {
        if(animation) animation.destroy();
        animation = lottie.loadAnimation({
          container: animationContainer,
          renderer: 'svg',
          loop,
          autoplay: true,
          path: path
        });
        animationContainer.style.display = 'block';
      }

      function stopLottieAnimation() {
        if(animation) {
          animation.destroy();
          animation = null;
        }
        animationContainer.style.display = 'none';
      }

      // Monitor animation load to reliably get totalFrames
      function waitForDataReady(anim) {
        return new Promise(resolve => {
          if(anim.isLoaded) resolve();
          else anim.addEventListener('data_ready', resolve);
        });
      }

      async function launchSequence() {
        launchBtn.disabled = true;
        launchBtn.style.display = 'none';
        readyText.style.display = 'none';

        // 1. Countdown
        await countdown(10);

        // 2. Suspense music + butterfly animation
        const butterfliesPath = 'https://assets9.lottiefiles.com/packages/lf20_butterfly.json';
        playLottieAnimation(butterfliesPath, true);
        await playAudio(suspenseAudio);

        // Wait until butterfly is done (let's say 7s), then fade out suspense
        await delay(7000);
        pauseAudio(suspenseAudio);
        stopLottieAnimation();

        // 3. Rocket animation
        const rocketPath = 'https://assets9.lottiefiles.com/packages/lf20_z4p6qhsy.json';
        playLottieAnimation(rocketPath, false);
        await waitForDataReady(animation);

        // Pause animation at 50%
        function pauseAtHalf() {
          if(animation.currentFrame >= animation.totalFrames / 2) {
            animation.pause();
            animation.removeEventListener('enterFrame', pauseAtHalf);
            revealProduct();
          }
        }
        animation.addEventListener('enterFrame', pauseAtHalf);

        // Safety timeout 10s in case animation stuck
        setTimeout(() => {
          if(animation) {
            animation.pause();
            animation.removeEventListener('enterFrame', pauseAtHalf);
            revealProduct();
          }
        }, 10000);
      }

      async function revealProduct() {
        stopLottieAnimation();
        productReveal.style.display = 'flex';
        productReveal.style.opacity = '1';
        await playAudio(applauseAudio);
        startConfetti();
      }

      function startConfetti() {
        const duration = 4000;
        const end = Date.now() + duration;
        const defaults = { startVelocity: 40, spread: 360, ticks: 60, zIndex: 1000 };

        function frame() {
          confetti({...defaults, particleCount: 10, origin: { x: Math.random() } });
          if (Date.now() < end) {
            confettiAnimationId = requestAnimationFrame(frame);
          }
        }
        frame();
      }

      function stopConfetti() {
        if(confettiAnimationId) {
          cancelAnimationFrame(confettiAnimationId);
          confettiAnimationId = null;
        }
      }

      launchBtn.addEventListener('click', () => {
        stopConfetti();
        launchSequence().catch(e => console.error("Launch sequence error:", e));
      });
    })();
  </script>
</body>
</html>
